/*
 * XenForo message.min.js
 * Copyright 2010-2018 XenForo Ltd.
 * Released under the XenForo License Agreement: https://xenforo.com/license-agreement
 */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(c,k,g){c instanceof String&&(c=String(c));for(var l=c.length,a=0;a<l;a++){var b=c[a];if(k.call(g,b,a,c))return{i:a,v:b}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(c,k,g){c!=Array.prototype&&c!=Object.prototype&&(c[k]=g.value)};
$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(c,k,g,l){if(k){g=$jscomp.global;c=c.split(".");for(l=0;l<c.length-1;l++){var a=c[l];a in g||(g[a]={});g=g[a]}c=c[c.length-1];l=g[c];k=k(l);k!=l&&null!=k&&$jscomp.defineProperty(g,c,{configurable:!0,writable:!0,value:k})}};
$jscomp.polyfill("Array.prototype.find",function(c){return c?c:function(c,g){return $jscomp.findInternal(this,c,g).v}},"es6","es3");
!function(c,k,g,l){XF.Message=XF.Message||{};XF.Message.insertMessages=function(a,b,d,e){XF.setupHtmlInsert(a,function(a,f,g){f=b.find(".js-replyNoMessages");f.length&&f.xfFadeUp();a.each(function(){this.tagName&&XF.Message.insertMessage(c(this),b,d)});e&&e(a)})};XF.Message.insertMessage=function(a,b,d){var c=b.children().first();a.hide();c.is("form")&&!d?a.insertAfter(c):d?b.append(a):b.prepend(a);a.xfFadeDown();XF.activate(a)};XF.MessageLoaderClick=XF.Click.newHandler({eventNameSpace:"XFMessageLoaderClick",
options:{href:null,messagesContainer:"< .js-replyNewMessageContainer",selfContainer:".message",ascending:!0},loading:!1,init:function(){this.options.href||console.error("Must be initialized with a data-href attribute.")},click:function(a){a.preventDefault();if(!this.loading){var b=this;XF.ajax("GET",this.options.href,{},XF.proxy(this,"loaded")).always(function(){b.loading=!1})}},loaded:function(a){if(a.html){var b=XF.findRelativeIf(this.options.messagesContainer,this.$target);XF.Message.insertMessages(a.html,
b,this.options.ascending);var d=this.$target.closest(this.options.selfContainer);d.xfFadeUp(null,function(){d.remove()});a.lastDate&&c('.js-quickReply input[name="last_date"]').val(a.lastDate)}}});XF.QuickEditClick=XF.Click.newHandler({eventNameSpace:"XFQuickEdit",options:{editorTarget:null,editContainer:".js-editContainer",href:null,noInlineMod:0},$editorTarget:null,$editForm:null,href:null,loading:!1,init:function(){var a=this.options.editorTarget;a?(this.$editorTarget=XF.findRelativeIf(a,this.$target),
this.$editorTarget.length?(this.href=this.options.href||this.$target.attr("href"))||console.error("No edit URL specified."):console.error("No quick edit target found")):console.error("No quick edit editorTarget specified")},click:function(a){this.$editorTarget&&this.href&&(a.preventDefault(),this.loading||(this.loading=!0,a={},this.options.noInlineMod&&(a._xfNoInlineMod=!0),XF.ajax("GET",this.href,a,XF.proxy(this,"handleAjax"),{skipDefaultSuccessError:!0})))},handleAjax:function(a){var b=this.$editorTarget,
d=this;a.errors||a.exception?this.loading=!1:XF.setupHtmlInsert(a.html,function(a,c){a.hide().insertAfter(b);XF.activate(a);d.$editForm=a;a.on("ajax-submit:response",XF.proxy(d,"editSubmit"));a.find(".js-cancelButton").on("click",XF.proxy(d,"cancelClick"));a.find("input[type=hidden]").first().after('<input type="hidden" name="_xfInlineEdit" value="1" />');b.xfFadeUp(null,function(){b.parent().addClass("is-editing");a.xfFadeDown(XF.config.speed.normal,function(){a.trigger("quick-edit:shown");var b=
a.find(d.options.editContainer);b.length&&b.get(0).scrollIntoView(!0);d.loading=!1})});a.trigger("quick-edit:show")})},editSubmit:function(a,b){if(!b.errors&&!b.exception){a.preventDefault();b.message&&XF.flashMessage(b.message,3E3);var d=this.$editorTarget,c=this;XF.setupHtmlInsert(b.html,function(a,e,g){e=c.options.editorTarget;e=e.replace(/<|\|/g,"").replace(/#[a-zA-Z0-9_-]+\s*/,"");var f=a.find(e);f.hide();d.replaceWith(f);c.$editorTarget=f;XF.activate(f);c.stopEditing(!1,function(){f.xfFadeDown();
c.$editForm.trigger("quickedit:editcomplete",b)})})}},cancelClick:function(a){this.stopEditing(!0)},stopEditing:function(a,b){var d=this.$editorTarget,c=this.$editForm,h=this,f=function(){d.parent().removeClass("is-editing");a&&d.xfFadeDown();b&&b();c.remove();h.$editForm=null};c?c.xfFadeUp(null,f):f()}});XF.QuoteClick=XF.Click.newHandler({eventNameSpace:"XFQuoteClick",options:{quoteHref:null,editor:".js-quickReply .js-editor"},init:function(){this.options.quoteHref||console.error("Must be initialized with a data-quote-href attribute.")},
click:function(a){a.preventDefault();var b=this.options.quoteHref,d=c(a.target).parents(".tooltip--selectToQuote");d=XF.unparseBbCode(d.data("quote-html"));XF.ajax("POST",b,{quoteHtml:d},XF.proxy(this,"handleAjax"),{skipDefaultSuccess:!0});c(a.target).trigger("s2q:click");a=XF.findRelativeIf(this.options.editor,this.$target);XF.focusEditor(a)},handleAjax:function(a){var b=XF.findRelativeIf(this.options.editor,this.$target);XF.insertIntoEditor(b,a.quoteHtml,a.quote)}});XF.MultiQuote=XF.Element.newHandler({options:{href:"",
messageSelector:"",addMessage:"",removeMessage:"",storageKey:""},mqStorage:null,mqOverlay:null,init:function(){this.initButton();this.initControls()},initButton:function(){this.mqStorage=XF.LocalStorage.getJson(this.options.storageKey);this.hasQuotesStored()&&this.$target.show();this.$target.on("click",XF.proxy(this,"buttonClick"))},buttonClick:function(a){a.preventDefault();if(!this.options.href)return console.error("Multi-quote button must have a data-href attribute set to display selected quotes"),
!1;XF.ajax("post",this.options.href,{quotes:XF.LocalStorage.get(this.options.storageKey)},XF.proxy(this,"loadOverlay"))},loadOverlay:function(a){if(a.html){var b=this;XF.setupHtmlInsert(a.html,function(a,c){a=XF.getOverlayHtml({html:a,title:c.h1||c.title});a.find(".js-removeMessage").on("click",XF.proxy(b,"removeMessage"));a.find(".js-quoteMessages").on("click",XF.proxy(b,"quoteMessages"));b.mqOverlay=XF.showOverlay(a)})}},removeMessage:function(a){a.preventDefault();var b=c(a.target).closest(".nestable-item");
a=b.data("id");var d=this.mqOverlay;this.removeFromMultiQuote(a);b.xfFadeUp(XF.config.speed.fast,function(){b.remove()});this.hasQuotesStored()||d.hide()},quoteMessages:function(a){a.preventDefault();a=this.mqOverlay;var b=a.getOverlay();b=c.parseJSON(b.find('input[name="message_ids"]').val());var d=this.mqStorage,e;for(e in b)if(b.hasOwnProperty(e)&&b[e].hasOwnProperty("id")){var h=b[e].id.split("-"),f=h[0];h=h[1];this.isValidQuote(d[f],h)&&(f=d[f][h],!0!==f&&(f=XF.unparseBbCode(f)),b[e].value=f)}a.hide();
XF.ajax("post",this.options.href,{insert:b,quotes:XF.LocalStorage.get(this.options.storageKey)},XF.proxy(this,"insertMessages"))},isValidQuote:function(a,b){return void 0==a||!a.hasOwnProperty(b)||!0!==a[b]&&"string"!=typeof a[b]?!1:!0},insertMessages:function(a){c.each(a,function(a,b){if(!b.hasOwnProperty("quote")||!b.hasOwnProperty("quoteHtml"))return!0;XF.insertIntoEditor(c(".js-editor").parent(),b.quoteHtml,b.quote)});for(var b in this.mqStorage)this.removeFromMultiQuote(b)},initControls:function(){var a=
".tooltip--selectToQuote, "+this.options.messageSelector,b=c(a).find(".js-multiQuote");c(g).on("click",a,XF.proxy(this,"controlClick"));var d=this;b.each(function(){var a=c(this),b=a.data("messageId");d.mqStorage.hasOwnProperty(b)&&(a.addClass("is-selected"),a.data("mqAction","remove"))})},controlClick:function(a){if(c(a.target).is(".js-multiQuote")){a.preventDefault();var b=c(a.target),d=b.data("mqAction");b=b.data("messageId");switch(d){case "add":this.addToMultiQuote(b);XF.flashMessage(this.options.addMessage,
3E3);break;case "remove":this.removeFromMultiQuote(b),XF.flashMessage(this.options.removeMessage,3E3)}c(a.target).trigger("s2q:click")}},addToMultiQuote:function(a){var b=c('.js-multiQuote[data-message-id="'+a+'"]'),d=b.parents(".tooltip--selectToQuote"),e=XF.unparseBbCode(d.data("quote-html"));b.length&&(b.addClass("is-selected"),b.data("mqAction","remove"));this.hasQuotesStored()?this.mqStorage[a]||(this.mqStorage[a]=[]):(this.mqStorage={},this.mqStorage[a]=[]);d.length?this.mqStorage[a].push(e):
this.mqStorage[a].push(!0);this.updateMultiQuote()},removeFromMultiQuote:function(a){var b=String(a).match(/^(\d+)-(\d+)$/);b?(a=b[1],delete this.mqStorage[a][b[2]],this.getQuoteStoreCount(this.mqStorage[a])||delete this.mqStorage[a]):delete this.mqStorage[a];this.mqStorage[a]||(a=c('.js-multiQuote[data-message-id="'+a+'"]'),a.length&&(a.removeClass("is-selected"),a.data("mqAction","add")));this.updateMultiQuote()},getQuoteStoreCount:function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&(1!=a[c]&&
"string"!=typeof a[c]||b++);return b},updateMultiQuote:function(){XF.LocalStorage.setJson(this.options.storageKey,this.mqStorage,!0);this.hasQuotesStored()?this.$target.show():this.$target.hide()},hasQuotesStored:function(){return this.mqStorage&&!c.isEmptyObject(this.mqStorage)}});XF.SelectToQuote=XF.Element.newHandler({options:{messageSelector:""},$quickReply:null,timeout:null,processing:!1,isMouseDown:!1,tooltip:null,tooltipId:null,init:function(){k.getSelection&&(this.options.messageSelector?
(this.$quickReply=c(".js-quickReply .js-editor").parent(),this.$quickReply.length&&(this.$target.on("mousedown",XF.proxy(this,"mouseDown")),this.$target.on("mouseup",XF.proxy(this,"mouseUp")),c(g).on("selectionchange",XF.proxy(this,"selectionChange")))):console.error("No messageSelector"))},mouseDown:function(){this.isMouseDown=!0},mouseUp:function(){this.isMouseDown=!1;this.trigger()},selectionChange:function(){this.isMouseDown||this.trigger()},trigger:function(){this.timeout||this.processing||(this.timeout=
setTimeout(XF.proxy(this,"handleSelection"),100))},handleSelection:function(){this.processing=!0;this.timeout=null;var a=k.getSelection(),b=this.getValidSelectionContainer(a);b?this.showQuoteButton(b,a):this.hideQuoteButton();var c=this;setTimeout(function(){c.processing=!1},0)},getValidSelectionContainer:function(a){if(a.isCollapsed||!a.rangeCount)return null;a=a.getRangeAt(0);this.adjustRange(a);if(!c.trim(a.toString()).length&&!a.cloneContents().querySelectorAll("img").length)return null;var b=
c(a.commonAncestorContainer).closest(".js-selectToQuote");return!b.length||!b.closest(this.options.messageSelector).find('.actionBar-action[data-xf-click="quote"]').length||c(a.startContainer).closest(".bbCodeBlock--quote, .js-noSelectToQuote").length||c(a.endContainer).closest(".bbCodeBlock--quote, .js-noSelectToQuote").length?null:b},adjustRange:function(a){var b=!1,d=!1,e=a.endContainer,h=c(e);0==a.endOffset&&(3!=e.nodeType||e.previousSibling||(h=h.parent()),d=0<h.closest(".bbCodeBlock--quote").length);
d&&(d=h.closest(".bbCodeBlock--quote"),d.length&&(a.setEndBefore(d[0]),b=!0));b&&(b=k.getSelection(),b.removeAllRanges(),b.addRange(a))},showQuoteButton:function(a,b){var c=a.xfUniqueId();this.tooltip&&this.tooltipId===c||(this.hideQuoteButton(),this.createButton(a,c));a=this.tooltip.getTooltip();a.data("quote-html",this.getSelectionHtml(b));b=this.getButtonPositionMarker(b);this.tooltip.setPositioner([b.left,b.top]);this.tooltip.isShown()?this.tooltip.reposition():this.tooltip.show();a.addClass("tooltip--selectToQuote")},
getButtonPositionMarker:function(a){var b=c("<span />").text("\u200b");var d=a.getRangeAt(0).cloneRange();a=d.getBoundingClientRect?d.getBoundingClientRect():null;d.collapse(!1);d.insertNode(b[0]);var e=0;do{d=!1;e++;b[0].parentNode&&"js-selectToQuoteEnd"==b[0].parentNode.className&&(b.insertBefore(b[0].parentNode),d=!0);b[0].previousSibling&&3==b[0].previousSibling.nodeType&&0==c.trim(b[0].previousSibling.textContent).length&&(b.insertBefore(b[0].previousSibling),d=!0);if(b[0].parentNode&&"LI"==
b[0].parentNode.tagName&&!b[0].previousSibling){var h=b[0].parentNode;c(h).prev("li").length?(b.appendTo(c(h).prev("li")),d=!0):h.parentNode&&(b.insertBefore(h.parentNode),d=!0)}b[0].parentNode&&!b[0].previousSibling&&-1!=c.inArray(b[0].parentNode.tagName,["DIV","BLOCKQUOTE","PRE"])&&(b.insertBefore(b[0].parentNode),d=!0);b[0].previousSibling&&-1!=c.inArray(b[0].previousSibling.tagName,["OL","UL"])&&(c(b[0].previousSibling).find("li:last").append(b),d=!0);b[0].previousSibling&&-1!=c.inArray(b[0].previousSibling.tagName,
["DIV","BLOCKQUOTE","PRE"])&&(b.appendTo(b[0].previousSibling),d=!0);b[0].previousSibling&&"BR"==b[0].previousSibling.tagName&&(b.insertBefore(b[0].previousSibling),d=!0)}while(d&&5>e);var f=b.offset();d=b.height();b.parentsUntil("body").each(function(){var a=c(this);switch(a.css("overflow-x")){case "hidden":case "scroll":case "auto":var b=a.offset().left;a=b+a.outerWidth();f.left<b&&(f.left=b);a<f.left&&(f.left=a)}});e=b.parent();b.remove();XF.browser.msie||e[0].normalize();a&&!XF.isRtl()&&32<f.left-
a.left&&(f.left-=16);f.top+=d;return f},createButton:function(a,b){var d=a.closest(this.options.messageSelector);a=c("<span />");var e=d.find(".actionBar-action.js-multiQuote").clone();e.length&&(e.attr("title","").removeClass("is-selected").data("mqAction","add").css({marginLeft:0,background:"transparent"}).on("s2q:click",XF.proxy(this,"buttonClicked")),a.append(e),a.append(g.createTextNode(" | ")));d=d.find('.actionBar-action[data-xf-click="quote"]').attr("title","").clone().css({marginLeft:0}).on("s2q:click",
XF.proxy(this,"buttonClicked"));a.append(d);this.tooltip=new XF.TooltipElement(a,{html:!0,placement:"bottom"});this.tooltipId=b},buttonClicked:function(){var a=k.getSelection();a.isCollapsed||(a.collapse(a.getRangeAt(0).commonAncestorContainer,0),this.hideQuoteButton())},hideQuoteButton:function(){var a=this.tooltip;a&&(a.destroy(),this.tooltip=null)},getSelectionHtml:function(a){var b=g.createElement("div"),c;var e=0;for(c=a.rangeCount;e<c;e++)b.appendChild(a.getRangeAt(e).cloneContents());return this.prepareSelectionHtml(b.innerHTML)},
prepareSelectionHtml:function(a){return XF.adjustHtmlForRte(a)}});XF.QuickReply=XF.Element.newHandler({options:{messageContainer:"",ascending:!0,filesContainer:".js-attachmentFiles",fileRow:".js-attachmentFile",insertAllRow:".js-attachmentInsertAllRow",submitHide:null},init:function(){this.$target.on("ajax-submit:before",XF.proxy(this,"beforeSubmit"));this.$target.on("ajax-submit:response",XF.proxy(this,"afterSubmit"));this.$target.on("draft:complete",XF.proxy(this,"onDraft"))},beforeSubmit:function(a,
b){(b=b.submitButton)&&"more_options"==b.attr("name")&&a.preventDefault()},afterSubmit:function(a,b){if(!b.errors&&!b.exception)if(a.preventDefault(),b.redirect)XF.redirect(b.redirect);else{this.$target.find('input[name="last_date"]').val(b.lastDate);this.getMessagesContainer().find(".js-newMessagesIndicator").remove();this.insertMessages(b.html);XF.clearEditorContent(this.$target);(a=XF.getEditorInContainer(this.$target))&&XF.Editor&&a instanceof XF.Editor&&a.blur();b=this.options;var c=this.$target.find(b.filesContainer);
c.length&&(c.removeClass("is-active"),a=c.find(b.insertAllRow),b=c.find(b.fileRow),a.length&&a.removeClass("is-active"),b.length&&b.remove());this.$target.trigger("preview:hide",[this]);this.options.submitHide&&XF.findRelativeIf(this.options.submitHide,this.$target).hide()}},insertMessages:function(a){XF.Message.insertMessages(a,this.getMessagesContainer(),this.options.ascending,function(a){if((a=a.first())&&a.length){a=a.dimensions();var b=c(k).scrollTop(),e=b+c(k).height();(a.top<b+50||a.top>e)&&
c("html, body").animate({scrollTop:Math.max(0,a.top-60)},200)}})},getMessagesContainer:function(){var a=this.options.messageContainer;return a?XF.findRelativeIf(a,this.$target).first():c(".js-replyNewMessageContainer").first()},onDraft:function(a,b){b.hasNew&&b.html&&!this.getMessagesContainer().find(".js-newMessagesIndicator").length&&this.insertMessages(b.html)}});XF.GuestCaptcha=XF.Element.newHandler({options:{url:"index.php?misc/captcha&with_row=1",target:".js-captchaContainer",skip:"[name=more_options]"},
$captchaContainer:null,initialized:!1,init:function(){var a=this.$target;this.$captchaContainer=a.find(this.options.target);this.$captchaContainer.length&&(a.on("focusin",XF.proxy(this,"initializeCaptcha")),a.on("submit ajax-submit:before",XF.proxy(this,"submit")))},initializeCaptcha:function(a){a=c(g.activeElement);this.initialized||a.is(this.options.skip)||(a=this.$captchaContainer.data("row-type")||"",XF.ajax("get",XF.canonicalizeUrl(this.options.url),{row_type:a},XF.proxy(this,"showCaptcha")),
this.initialized=!0)},showCaptcha:function(a){var b=this;XF.setupHtmlInsert(a.html,function(a,c,h){a.replaceAll(b.$captchaContainer);h()})},submit:function(a){if(!this.initialized&&!c(g.activeElement).is(this.options.skip))return a.preventDefault(),!1}});XF.PostEdit=XF.Element.newHandler({init:function(){this.$target.on("quickedit:editcomplete",XF.proxy(this,"editComplete"))},editComplete:function(a,b){var d=this;XF.setupHtmlInsert(b.html,function(a,h,f){f=b.threadChanges||{};f.title&&(c("h1.p-title-value").html(h.h1),
c("title").html(h.title),XF.config.visitorCounts.title_count&&b.visitor&&(XF.pageTitleCache=h.title,XF.pageTitleCounterUpdate(b.visitor.total_unread)));if(f.customFields){var e=a.closest(".js-threadStatusField"),g=XF.findRelativeIf("< .block--messages | .js-threadStatusField",d.$target);e.length&&g.length&&g.xfFadeUp(XF.config.speed.fast,function(){g.replaceWith(e).xfFadeDown(XF.config.speed.fast)})}else a.find(".js-threadStatusField").remove()})}});XF.Click.register("message-loader","XF.MessageLoaderClick");
XF.Click.register("quick-edit","XF.QuickEditClick");XF.Click.register("quote","XF.QuoteClick");XF.Element.register("multi-quote","XF.MultiQuote");XF.Element.register("select-to-quote","XF.SelectToQuote");XF.Element.register("quick-reply","XF.QuickReply");XF.Element.register("guest-captcha","XF.GuestCaptcha");XF.Element.register("post-edit","XF.PostEdit")}(jQuery,window,document);
